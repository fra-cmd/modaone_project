{% extends 'base.html' %} 

{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="display-5 fw-bold mb-4">{{ titulo }}</h1>
    <p class="text-muted">Consulta el estado de tus compras y su trazabilidad.</p>
    <hr>
    
    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">N° Orden</th>
                                    <th>Fecha</th>
                                    <th>Total</th>
                                    <th>Estado del Envío</th>
                                    <th>Detalle</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for orden in ordenes %}
                                <tr>
                                    <td class="ps-4 fw-bold text-dark">#{{ orden.numero_orden }}</td>
                                    <td>{{ orden.fecha_creacion|date:"d/m/Y H:i" }}</td>
                                    <td>${{ orden.total_final|floatformat:0 }}</td>
                                    <td>
                                        {% if orden.estado == 'ENTREGADO' %}
                                            <span class="badge bg-success py-2">ENTREGADO</span>
                                        {% elif orden.estado == 'DESPACHO' %}
                                            <span class="badge bg-primary py-2">EN DESPACHO</span>
                                        {% elif orden.estado == 'CONFIRMADO' %}
                                            <span class="badge bg-info text-dark py-2">EN PREPARACIÓN</span>
                                        {% else %}
                                            <span class="badge bg-secondary py-2">{{ orden.get_estado_display|upper }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-dark" type="button" data-bs-toggle="collapse" data-bs-target="#detalle{{ orden.id }}" aria-expanded="false" aria-controls="detalle{{ orden.id }}">
                                            Ver Items
                                        </button>
                                    </td>
                                </tr>
                                <tr class="collapse" id="detalle{{ orden.id }}">
                                    <td colspan="5" class="bg-light border-0 py-1">
                                        <div class="p-3">
    <p class="mb-1 small"><strong>Dirección:</strong> {{ orden.direccion_envio }}</p>
    <hr class="my-2">
    
    {% if orden.codigo_seguimiento %}
        <div class="alert alert-info py-2 px-3 mb-0 small">
            <i class="fas fa-shipping-fast me-2"></i>
            <strong>Tracking ID:</strong> {{ orden.codigo_seguimiento }}
            
            <a href="https://www.blue.cl/seguimiento/?n_seguimiento={{ orden.codigo_seguimiento }}" target="_blank" class="float-end text-decoration-none fw-bold">
                Rastrear Pedido &rarr;
            </a>
        </div>
    {% elif orden.estado == 'DESPACHO' %}
        <p class="mb-0 small text-warning fw-bold">
            <i class="fas fa-clock me-1"></i> Esperando número de seguimiento...
        </p>
    {% endif %}
</div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center py-5 text-muted">Aún no has realizado ninguna compra.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}